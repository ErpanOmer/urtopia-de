{% assign random = "now" | date: "%M" | divided_by: 10 | modulo: 2 %}

<script>
  const abtest_type =  '{% if random == 0 %}A{% else %}B{% endif %}'
  console.log('abtest_type', {{ session  }})

  if (!window.sessionStorage.ebikePageVisited) {
    window.sessionStorage.ebikePageVisited = 'ebikePageVisited'

    fetchBuried('a-b-test', 'carbon-ebikepage', {
        action_type: abtest_type,
        event_name: 'page-view'
    }, true)
  }

  clarity("set", "A_B_TEST", `carbon-ebikepage-${abtest_type}`);
</script>

{% if random == 1 %}
  {% render 'carbon-ebike-page-a' %}
{% else %}
  {% render 'carbon-ebike-page-b' %}
{% endif %}

<script>
  $('[action_type]').on('click', e => {

    // 如果点击过 就别再统计
    if (!window.sessionStorage.ebikePageButtonClicked) {
      const action_type = $(e.target).closest('[action_type]').attr('action_type')

      window.sessionStorage.ebikePageButtonClicked = 'ebikePageButtonClicked'

      fetchBuried('a-b-test', 'carbon-ebikepage', {
        action_type: abtest_type,
        event_name: 'button-click',
        button: action_type
      }, true)
    }
  })
</script>