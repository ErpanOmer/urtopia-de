{{ 'sumoselect.min.css' | asset_url | stylesheet_tag }}

<div class="forms2" id="forms">
    <div class="centeral-content">
        <div>
            <div class="texts">
                <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/jr-color_2x_1c8a412f-c3e7-471b-bbf6-66fdf962538f.png?v=1684121689"
                    alt="">
                <div class="u36DemiBold_v2">Urtopia leasing request form</div>
                <div class="u20DemiBold_v2">Step 1:</div>
                <div class="u17DemiBold_v2">Fill in your contact info</div>
                <div class="u17Light_v2">We require your contact information to communicate important updates and
                    facilitate the leasing process. Rest assured, your details will be kept confidential and used solely
                    for lease-related communications.</div>
            </div>
            <div class="steps">
                <div class="progress">
                    <div class="item active" style="border-style: none;">
                        <div class="u24DemiBold_v2">1</div>
                        <div class="u17DemiBold_v2">Contact <br class="pcHide">Info</div>
                    </div>
                    <div class="item" style="border-style: none;">
                        <div class="u24DemiBold_v2">2</div>
                        <div class="u17DemiBold_v2">Shipping <br class="pcHide">Info</div>
                    </div>
                    <div class="item" style="border-style: none;">
                        <div class="u24DemiBold_v2">3</div>
                        <div class="u17DemiBold_v2">Bike <br class="pcHide">Selection</div>
                    </div>
                    <div class="success">
                        <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Group_21035_2x_7835d09b-ec3a-4068-abb7-3ed0bf390ad0.png?v=1684123007"
                            alt="">
                    </div>
                </div>
                <div class="items step-1">
                    <form action="" method="post">
                        <div class="item">
                            <div class="u24Medium">Your employer already offers JobRad?<i>*</i></div>
                            <div class="multiple-checkbox">
                                <label for="yes">
                                    <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Group_20956_2x_28b3e62b-ae48-4b7c-a025-4db2d0cdbf2d.png?v=1683713191"
                                        alt="">
                                    <span class="u17Medium_v2">Yes</span>
                                    <input type="radio" id="yes" name="offers" value="yes" required />
                                </label>
                                <label for="no">
                                    <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Group_20956_2x_28b3e62b-ae48-4b7c-a025-4db2d0cdbf2d.png?v=1683713191"
                                        alt="">
                                    <span class="u17Medium_v2">Not sure</span>
                                    <input type="radio" id="no" name="offers" value="no" required />
                                </label>
                            </div>
                        </div>
                        <div class="item">
                            <div class="mini-item">
                                <div>
                                    <div class="u24Medium">First name<i>*</i></div>
                                    <input type="text" name="first_name" required>
                                </div>
                                <div>
                                    <div class="u24Medium">Last name<i>*</i></div>
                                    <input type="text" name="last_name" required>
                                </div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="u24Medium">Email<i>*</i></div>
                            <input type="email" name="email" required>
                        </div>
                        <div class="item">
                            <div class="u24Medium">Phone number<i>*</i></div>
                            <input type="tel" name="phone" required>
                        </div>
                        <div class="item">
                            <div class="u24Medium">Employer<i>*</i></div>
                            <input type="text" name="employer" required>
                        </div>
                        <div class="buttons">
                            <button class="my-button my-button-black" type="submit">Next</button>
                        </div>
                    </form>
                </div>
                <div class="items step-2">
                    <form action="" method="post">
                        <div class="item">
                            <div class="u24Medium">Delivery address<i>*</i></div>
                            <input type="text" name="address" required>
                        </div>
                        <div class="item">
                            <div class="mini-item">
                                <div>
                                    <div class="u24Medium">Postal code<i>*</i></div>
                                    <input type="text" name="postal_code" required>
                                </div>
                                <div>
                                    <div class="u24Medium">City<i>*</i></div>
                                    <input type="text" name="city" required>
                                </div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="u24Medium">Country<i>*</i></div>
                            <input type="text" name="country" value="Deutschland" disabled required>
                        </div>
                        <div class="buttons">
                            <div class="my-button my-button-white pervious">Previous</div>
                            <button class="my-button my-button-black" type="submit">Next</button>
                        </div>
                    </form>
                </div>
                <div class="items step-3">
                    <form action="" method="post">
                        <div class="u17DemiBold_v2 bike_you_choose" style="display: none;">Bike you choose:</div>
                        <img class="bike_image" src="">
                        <div class="item">
                            <div class="u24Medium">Bike Model<i>*</i></div>
                            <input type="text" name="bike_model" value="Carbon 1" disabled required>
                        </div>
                        <div class="item">
                            <div class="mini-item">
                                <div>
                                    <div class="u24Medium">Bike Size<i>*</i></div>
                                    <select name="bike_size" required>
                                        <option value="">---</option>
                                        <!--<option value="M">M - Fit for 170-185 cm</option>
                          <option value="L">L - Fit for 180-195 cm</option>
                          -->
                                    </select>
                                </div>
                                <div>
                                    <div class="u24Medium">Bike Style<i>*</i></div>
                                    <select name="bike_style" required>
                                        <option value="">---</option>
                                        <!--<option value="Sirius">Sirius</option>
                          <option value="Lyra">Lyra</option>
                          <option value="Midnight in Paris">Midnight in Paris</option>
                          <option value="Vanilla">Vanilla</option>
                          -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="u24Medium">Accessories you would like
                                <!--<br><span
                                    style="font-size: 12px;color: #666;line-height: 16px;display: inline-block;">Father’s
                                    Day gifts: kickstand, Fender, water bottle cage will sent to you automatically, will
                                    not show in your jobrad offer (Ends on 18th of May)</span>-->
                            </div>
                            <select name="accessories" multiple>
                                {% for collection in collections %}
                                {% if collection.title == 'Carbon 1 leasing acc' %}
                                {% for product in collection.products %}
                                <option title="{{product.title}}" value="{{product.id}}">{{ product.title }}</option>
                                {% endfor %}
                                {% endif %}
                                {% endfor %}
                            </select>
                            <!-- <input type="text" name="accessories" placeholder="" > -->
                        </div>
                        <div class="item">
                            <div class="u24Medium">Note</div>
                            <input type="text" name="note">
                        </div>
                        <div class="item">
                            <div class="checkbox">
                                <input type="checkbox" id="subscribe" name="subscribe" value="subscribe" required />
                                <label class="u17Light" for="subscribe" style="text-align: left;">I agree to allow
                                    Urtopia to store and process my
                                    personal data, including receiving emails, text messages and SMS.<i>*</i></label>
                            </div>
                        </div>
                        <div class="buttons">
                            <div class="my-button my-button-white pervious">Previous</div>
                            <button class="my-button my-button-black" type="submit">Submit</button>
                        </div>
                    </form>
                </div>
                <div class="items step-4">
                    <div class="u24DemiBold_v2">Submition Detail</div>
                    <div class="infos">
                        <div class="info" name="first_name">
                            <label class="u17DemiBold_v2">First name:</label>
                            <span class="u17Light_v2">stephen</span>
                        </div>
                        <div class="info" name="last_name">
                            <label class="u17DemiBold_v2">Last name:</label>
                            <span class="u17Light_v2">stephen</span>
                        </div>
                        <div class="info" name="email">
                            <label class="u17DemiBold_v2">Email:</label>
                            <span class="u17Light_v2">stephen</span>
                        </div>
                        <div class="info" name="phone">
                            <label class="u17DemiBold_v2">Phone number:</label>
                            <span class="u17Light_v2">stephen</span>
                        </div>
                        <div class="info" name="employer">
                            <label class="u17DemiBold_v2">Employer:</label>
                            <span class="u17Light_v2">stephen</span>
                        </div>
                        <div class="info" name="address">
                            <label class="u17DemiBold_v2">Delivery address:</label>
                            <span class="u17Light_v2">stephen</span>
                        </div>
                        <div class="info" name="postal_code">
                            <label class="u17DemiBold_v2">Postal code:</label>
                            <span class="u17Light_v2">stephen</span>
                        </div>
                        <div class="info" name="city">
                            <label class="u17DemiBold_v2">City:</label>
                            <span class="u17Light_v2">stephen</span>
                        </div>
                        <div class="info" name="country">
                            <label class="u17DemiBold_v2">Country:</label>
                            <span class="u17Light_v2">stephen</span>
                        </div>
                        <div class="info" name="bike">
                            <label class="u17DemiBold_v2">Bike Detail:</label>
                            <span class="u17Light_v2">
                                <img class="bike_image" src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18562_2x_d5c1f716-cf97-484c-89bd-b9165c330c11.jpg?v=1684139146"
                                    alt="">
                                <span class="bike_size_style">Carbon 1, sirus, Large(fit for 180-195 cm)</span>
                            </span>
                        </div>
                        <div class="info" name="accessories">
                            <label class="u17DemiBold_v2">Accessories:</label>
                            <span class="u17Light_v2"></span>
                        </div>
                        <div class="info" name="note">
                            <label class="u17DemiBold_v2">Note:</label>
                            <span class="u17Light_v2"></span>
                        </div>
                        <div class="u14Light_v2">If the information above is incorrect, please submit <br
                                class="mobileHide">again or email
                            us at leasing@newurtopia.de</div>
                    </div>
                    <div class="buttons">
                        <div class="my-button my-button-white again">Submit again</div>
                        <a class="my-button my-button-black" href="/pages/contactus">Contact us</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<link rel="prefetch" href="https://cdn.shopifycdn.net/s/files/1/0633/2068/6808/products/img_v2_008465de-4dc9-42f4-99b9-52816dbc2eag_1.webp?v=1678963826" as="image">
<link rel="prefetch" href="https://cdn.shopifycdn.net/s/files/1/0633/2068/6808/products/img_v2_c011bd46-4e3b-4b0f-8b9f-074a0ba53e6g_1.webp?v=1678963826" as="image">
<link rel="prefetch" href="https://cdn.shopifycdn.net/s/files/1/0633/2068/6808/products/img_v2_c1f4e864-1ce0-4700-a6da-18071624e1dg_1.webp?v=1678963826" as="image">
<link rel="prefetch" href="https://cdn.shopifycdn.net/s/files/1/0633/2068/6808/products/MaskGroup18137_1.webp?v=1678963826" as="image">

{{ 'sumoselect.js' | asset_url | script_tag }}

<script>
    // 页面信息
const page_infos = {% case template | json %}
    {% when 'page.jobrad-leasing-new2' %}
        {
            page_name: 'jobrad'
        }
    {% else %}
        {}
{% endcase %}


// size 映射
const size_map = {
    M: 'Fit for 170-185 cm',
    L: 'Fit for 180-195 cm'
}
// 表单忽略项
const ignore = ['submit', 'checkbox', 'image', 'hidden']
// carbon 产品信息
const carbon = JSON.parse(JSON.stringify({{ all_products['urtopia-carbon-e-bike'] | json }}))

// 尺寸信息
const size = Array.from(new Set(carbon.variants.map(i => i.option2)))
const style = Array.from(new Set(carbon.variants.map(i => i.option1)))

// 是否已提交
let is_submited = false

// 表单步骤 tag
const leave_stage_map = {
    1: 'Contact Info',
    2: 'Shipping Info',
    3: 'Bike Selection',
    999: 'Employer Info'
}

// 当前step
let currentStep = 1
// 是否重新提交
let submitAgain = false
// 是否是手机
const isMobile = document.body.clientWidth < 768

console.log('page_infos', page_infos)
console.log('carbon', carbon)

function gtag_report_conversion(url) {
    var callback = function () {
      if (typeof(url) != 'undefined') {
        window.location = url;
      }
    };
    gtag('event', 'conversion', {
        'send_to': 'AW-10876491006/sCHgCIiX55oYEP6pqMIo',
        'event_callback': callback
    });
    return false;
}


function getFormValues (elem = '') {
    const temp = {}

    if (!elem) {
        return temp
    }

    $(elem).each((index, target) => {
        if (ignore.includes(target.type)) {
            return
        }


        
        // 配件特殊处理
        if (target.name === 'accessories') {
            const accessories = []
            const accessories_id = []
            
            // selected
            $(target).find('option:selected').each((i, target) => {
                accessories.push(target.title)
                accessories_id.push(target.value)
            })

                
            temp.accessories = accessories.join()
            temp.accessories_id = accessories_id.join()

            return
        }


        temp[target.name] = target.value
    })

    temp.variant_id = carbon.variants.find(c => c.title === `${temp.bike_style} / ${temp.bike_size}`)
    temp.variant_id = temp.variant_id ? temp.variant_id.id : ''
    temp.offers = $('.forms2 label[class="active"]').attr('for')

    return temp
}




// 页面访问key
const visited_key = `${page_infos.page_name}_page_is_visited`
// 页面访问
if (!!!sessionStorage[visited_key]) {
    fetchBuried(page_infos.page_name, 'pageview')
}

// 记录来过这个页面
sessionStorage[visited_key] = visited_key



// 页面退出之前，往服务器提交数据
document.addEventListener('visibilitychange', () => {
    // 如果已提交过，不用再次提交
    if (is_submited) {
        return
    }

    if (document.visibilityState === 'hidden') {
        // fetchBuried(page_infos.page_name, 'submitinfo', mergeValues(), true)
    }
})
</script>