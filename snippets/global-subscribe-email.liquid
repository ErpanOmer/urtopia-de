<link rel="preload" href="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/DSCF1917_2x_0b6b06c9-1b85-4b3c-a719-ec14d98e1f44.jpg?v=1694504440&width=500" as="image">
<link rel="preload" href="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/DSCF1917_2x_dfd4cb85-f938-4f12-a549-6eedec9aa47c.jpg?v=1694504405&width=375" as="image">
<style>
  .subscribe-container .u72DemiBold_v2 {
    margin: 12% 0;
  }

  @media (max-width: 767px) {
    .subscribe-container .u72DemiBold_v2 {
      margin: 10% 0;
      font-size: 48px;
    }

    .subscribe-container .u72DemiBold_v2 .u30DemiBold_v2 {
      font-size: 20px;
    }
  }
</style>
<script>
  const email_dialog_session_key = 'emailDialogHideDay'

      // 邮件订阅弹窗
  const subscribeHtml = `<div class="subscribe-container">
    <img class="mobileHide" src="${global_config.subscribe_email_dialog_config.background_imgae_pc}" alt="">
    <img class="pcHide" src="${global_config.subscribe_email_dialog_config.background_imgae_mb}" alt="">
    <div class="subscribe">
        <span class="u20DemiBold_v2">{{ settings.sale_name }}</span>
        <div class="u72DemiBold_v2">{{ settings.carbon_ebike_discount_price | money_without_trailing_zeros }}<span class="u30DemiBold_v2">OFF</span></div>
        <span class="u17Light_v2">Subscribe to Urtopia for exclusive coupons, engaging stories, and the latest product news.</span>
        <form class="new-contact" action="/contact#ContactFooter" target="_blank" method="post" accept-charset="UTF-8">
        <div class="email">
              <input type="hidden" name="form_type" value="customer">
              <input type="hidden" name="utf8" value="✓">
              <input type="hidden" name="contact[tags]" value="newsletter">
              <input placeholder="Enter email here" type="email" name="contact[email]" required>
              <button class="my-button my-button-black" id="global_email_submit_button" type="submit">Subscribe</button>
        </div>
      </form>
    </div>
    <span class="close" onclick="closeEmailDialog()">×</span>
</div>`
    

    /*
    const subscribeHtml = `<div class="subscribe-container">
      <img class="mobileHide" src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Group_20879_2x_9eb77960-cc47-4d48-b823-835a9ef7314b.jpg?v=1681804735" alt="">
      <img class="pcHide" src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230418-160913.jpg?v=1681805365" alt="">
      <div class="subscribe">
          <span class="u30DemiBold_v2">Join Urtopia and Get Exclusive Coupon</span>
          <img style="height:0;" src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Union_12_2x_f3408316-66ce-44c8-ad74-6ee638a54650.jpg?v=1681095007">
          <span class="u17Light">Subscribe to Urtopia for exclusive coupons, engaging stories, and the latest product news.</span>
          <form class="new-contact" action="/contact#ContactFooter" target="_blank" method="post" accept-charset="UTF-8">
          <div class="email">
                <input type="hidden" name="form_type" value="customer">
                <input type="hidden" name="utf8" value="✓">
                <input type="hidden" name="contact[tags]" value="newsletter">
                <input placeholder="Enter email here" type="email" name="contact[email]" required>
                <button class="my-button my-button-black" type="submit">Subscribe</button>
          </div>
        </form>
      </div>
      <span class="close" onclick="closeEmailDialog()">×</span>
    </div>`
*/


  function showEmailDialog(emailtag) {
    if (global_config.subscribe_email_dialog_config.is_hide) {
        return
    }

    if (!emailtag && storage.get(email_dialog_session_key)) {
      return;
    }

    showMiniDialog(subscribeHtml);

    setTimeout(() => {
      $('.subscribe-container form').on('submit', function (event) {
        const email = $('.subscribe-container form input[type="email"]').val();
        // 埋点
        fetchBuried('emailpop', 'submit', { email, tag: `DE,POPUP${emailtag ? ',' + emailtag : ''}` }).then(() => {
          dataLayer.push({
                'event'    :'global_email_submit',
                'pageType' :'emailpop',
            });
        });
        closeEmailDialog(14);

        event.preventDefault();
        return false;
      });

      let startInput = false;
      $('.subscribe-container input').on(
        'input',
        debounce((e) => {
          if (startInput) {
            return;
          }

          startInput = true;
          fetchBuried('emailpop', 'enter', {
            email: e.target.value,
            tag: 'DE,POPUP',
          });
        }, 2000)
      );
    }, 1000);
  }



  function closeEmailDialog (day = 3) {
    storage.set(email_dialog_session_key, email_dialog_session_key, day)
    // 关闭弹窗
    closeMiniDialog()
  }
</script>
