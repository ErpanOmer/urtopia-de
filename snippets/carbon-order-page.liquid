<div class="product" data-pf-type="ProductBox">
    <div class="centeral-content">
        <div class="commonComponent pcHide">
            <div class="u36DemiBold_v2">{{ product.title }}</div>
            <div data-pf-type="JudgeMe" class="sc-eZhRLC gtfCKx pf-25_ order-djs mb6">
                <div class="pf-judme">{% render "judgeme_widgets", widget_type: "judgeme_preview_badge", jm_style: "", concierge_install: false, product: product %}</div>
            </div>
            <div class="u30DemiBold_v2 mb6">{{ product.price | money }}</div>
            <div class="sale mb6">
                <div class="u20DemiBold_v2">€2.699,00 NOW</div>
                <div class="u17DemiBold_v2">with {{ settings.sale_name }}</div>
            </div>
        </div>
        <div class="featured_image">
            <div class="swiper left-swiper mobileHide">
                <div class="swiper-wrapper">
                </div>
            </div>
            <div class="swiper right-swiper" style="--swiper-navigation-color: #fff;--swiper-theme-color: #000;--swiper-pagination-color: #000;">
                <div class="swiper-wrapper">
                    {% comment %} {% for image in product.images %}
                        <div class="swiper-slide">
                            {{ image | image_url: width: 1000 | image_tag }}
                        </div>
                    {% endfor %} {% endcomment %}
                </div>
                <div class="swiper-button-prev mobileHide"></div><!--左箭头。如果放置在swiper外面，需要自定义样式。-->
                <div class="swiper-button-next mobileHide"></div><!--右箭头。如果放置在swiper外面，需要自定义样式。-->
                <div class="swiper-pagination pcHide"></div>
                <div class="flex-1 mobileHide"></div>
                <div class="parameters mobileHide">
                    <div>
                        <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18448_2x_833c8995-fa19-4297-af29-678ac4064d0c.png?v=1687176385"/>
                        <span><span class="u14Light_v2">Carbon Fiber</span><span class="u17DemiBold_v2">15 kg.</span></span>
                    </div>
                    <div>
                        <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18449_2x_e118ab7b-18ca-4612-afb3-20758874d9c7.png?v=1687177181"/>
                        <span><span class="u14Light_v2">Fast & Easy</span><span class="u17DemiBold_v2">90% Assembled</span></span>
                    </div>
                    <div>
                        <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18445_2x_2e6c6230-7ed1-4c3d-99ad-54ba48fa57b4.png?v=1687177370"/>
                        <span><span class="u14Light_v2">Adaptive</span><span class="u17DemiBold_v2">Torque Sensor</span></span>
                    </div>
                    <div>
                        <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18447_2x_c102facd-9087-4028-8f97-34a7af31b1f6.png?v=1687177414"/>
                        <span><span class="u14Light_v2">Range</span><span class="u17DemiBold_v2">100 Km</span></span>
                    </div>
                    <div>
                        <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18450_2x_50383af6-61df-4632-9cbc-531630580f61.png?v=1687177242"/>
                        <span><span class="u14Light_v2">Phone App</span><span class="u17DemiBold_v2">iOS, Android</span></span>
                    </div>
                    <div>
                        <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18446_2x_791e060a-ed39-42c5-9cf0-965d7e5110bb.png?v=1687177232"/>
                        <span><span class="u14Light_v2">Anti-theft</span><span class="u17DemiBold_v2">GPS Tracking</span></span>
                    </div>
                </div>
            </div>            
        </div>
        <form method="post" accept-charset="UTF-8" action="/cart/add" class="product-panel pf-product-form" data-productid={{ product.id }} id="product_form_{{ product.id }}" enctype="multipart/form-data">
            <input type="hidden" name="id" data-product-id="{{product.id}}" value="{{ product.selected_or_first_available_variant.id }}"/>
            <input type="hidden" name="form_type" value="product">
            <input type="hidden" name="utf8" value="✓">
            <div class="commonComponent mobileHide">
                <div class="u36DemiBold_v2 mb12">{{ product.title }}</div>
                <div data-pf-type="JudgeMe" class="sc-eZhRLC gtfCKx pf-25_ order-djs mb12">
                    <div class="pf-judme">{% render "judgeme_widgets", widget_type: "judgeme_preview_badge", jm_style: "", concierge_install: false, product: product %}</div>
                </div>
                <div class="u30DemiBold_v2 mb12">{{ product.price | money }}</div>
                <div class="sale mb12">
                    <div class="u20DemiBold_v2">€2.699,00 NOW</div>
                    <div class="u17DemiBold_v2">with {{ settings.sale_name }}</div>
                </div>
            </div>
            <div class="sale_acc mb12 belt" id="sale_acc">
                <div class="u14Light_v2">And get <span style="font-weight: 600;">€169</span> Accessories for <span class="u20DemiBold_v2">Free</span></div>
                {% assign accessories_map = "7633738596568,7633738662104,7633738531032" | split: ',' %}
                <div class="accs">
                    {% for acc in accessories_map %}
                        {% for prod in collections["accessories"].products %}
                            {% if acc contains prod.id %}
                                <div class="acc">
                                    {{ prod.featured_image | image_url: width: 400 | image_tag }}
                                    {% if acc == "7633738662104" %}
                                        <span class="u11Medium_v2">{{ prod.title | truncatewords: 3, "" | replace: "-", "" }}</span>
                                    {% else %}
                                        <span class="u11Medium_v2">{{ prod.title }}</span>
                                    {% endif %}
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                </div>
                <div class="u11Light_v2">*Not available with leasing</div>
            </div>
            <div class="sale_acc mb12 gear">
                <div class="u14Light_v2">Get Accessories for <span class="u20DemiBold_v2">Free</span></div>
                {% assign accessories_map_1s = "7633738596568,7633738531032" | split: ',' %}
                <div class="accs_1s">
                    {% for acc in accessories_map_1s %}
                        {% for prod in collections["accessories"].products %}
                            {% if acc contains prod.id %}
                                <div>
                                    {{ prod.featured_image | image_url: width: 400 | image_tag }}
                                    <span class="u11Medium_v2">{{ prod.title }}</span>
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                </div>
                <div class="u11Light_v2">*Not available with leasing</div>
            </div>
            <div class="count-down mb12 mobileHide">
                <div class="u17Medium_v2">€600 off + 3 Free Accessories Ends in：</div>
                <img src="http://i.countdownmail.com/2mmaed.gif">
            </div>
            <div class="options">
                {% for option in product.options %}
                    <div class="option" option={{option}}>
                        <div class="u17DemiBold_v2 mb12">{{ option }} - <span class="u17Light_v2"></span></div>
                        <div class="{{ option }} mb12"></div>
                    </div>
                {% endfor %}
            </div>
            <div class="accessories">
                <div class="u17DemiBold_v2 mb12">Accessories</div>
                <div class="navigate">
                    <div class="prev"></div>
                    <div class="next"></div>
                </div>
                <div class="items mb12">
                    {% for prod in collections['on-page'].products %}
                        {% if prod.available %}
                            {% assign variant = prod.variants | first %}
                            <div class="item" variant-id="{{ variant.id }}">
                                {{ prod.featured_image | image_url: width: 400 | image_tag }}
                                <div>
                                    <span class=u11Light_v2>
                                        <i class="fa-solid fa-plus"></i>
                                    </span>
                                    <span class="u17DemiBold_v2">{{ prod.price | money }}</span>
                                    <span class="u11Medium_v2">{{ prod.title }}</span>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>       
            <div class="buttons">
                <div class="count-down mb12 pcHide">
                    <div class="u17Medium_v2">€600 off + 3 Free Accessories Ends in：</div>
                    <img src="http://i.countdownmail.com/2mmaed.gif">
                </div>
                <div
                    data-product-id="{{ product.id }}"
                    class="my-button my-button-origin addToCartBtn"
                    onclick="addAllToCart('atc')"
                    id="addToCart"
                    >
                    <i class="fa fa-spinner fa-spin"></i><span data-pf-type="Text" class="addToCartText u17DemiBold_v2">Add to Cart</span>
                </div>
                <div onclick="testRideTrace('lease_on_jobrad', this)" class="orderTestRideBtn">
                    <img class="oneeee" src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/jobradorg_2x_423443a0-1c79-4785-97a0-2be8ae66ceb6.png?v=1685414275"/>
                    <span><span class="u17DemiBold_v2">Lease Now</span><!--<span>36 months, €48/month</span>--></span>
                  </div>
                  <div onclick="testRideTrace('klarna_check_out', this)" class="orderTestRideBtn">
                    <img class="twoooo"src="https://cdn.shopifycdn.net/s/files/1/0633/2068/6808/files/20230530-121400.png?v=1685420054"/>
                    <span><span class="u17DemiBold_v2">0% APR Financing</span><span>24 months, €112/month</span></span>
                </div>
            </div>
            <div class="delivery_time mb12">Free shipping <span>within 5 days</span></div>
            <div class="support mb12">
                <a href="#boxs3">
                    <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230621-005713.png?v=1687280264"/>
                    <span class="u11Medium_v2">30+ Spots<br>of Service</span>
                </a>
                <a href="/pages/shipping-and-return" target="_blank">
                    <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_17959_2x_cff00041-4dce-479b-b87d-55b1cb89cd7a.png?v=1687161086"/>
                    <span class="u11Medium_v2">14-Day<br>Returns</span>
                </a>
                <a href="/pages/warranty" target="_blank">
                    <img src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_17958_2x_1e776f09-0686-4672-a22f-b29d2df3898d.png?v=1687161098"/>
                    <span class="u11Medium_v2">2-Year<br>Warranty</span>
                </a>
            </div>
            <div class="dialogs">
                <div class="u17Medium_v2">
                    <span>Size & Fit</span>
                    <span>&gt;</span>
                </div>
                <div class="u17Medium_v2">
                    <span>Technical Specifications</span>
                    <span>&gt;</span>
                </div>
                <div class="u17Medium_v2">
                    <span>Support & Service</span>
                    <span>&gt;</span>
                </div>
                <div class="u17Medium_v2">
                    <span>FAQs</span>
                    <span>&gt;</span>
                </div>
            </div>
        </form>
    </div>
</div>

<img class="toTop" src="https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Group_21049.svg?v=1687267470">

<div class="top-fixed mobileHide">
    <div class="centeral-content">
        <span class="u20DemiBold_v2">{{ product.title }}</span>
        <span class="flex-1"></span>
        <div>
            <span class="u17Light_v2"><span class="u20DemiBold_v2 emphasize" style="font-weight: 600;">{{ 269900 | money }}</span> <span style="text-decoration: line-through;">{{ product.price | money }}</span></span>
            <span class="u14Light_v2">or as low as €112/Month</span>
        </div>
        <a href="#sale_acc" class="my-button my-button-origin">Order Now</a>
    </div>
</div>

<div class="bottom-fixed pcHide">
    <a href="#sale_acc" class="my-button my-button-origin">Order Now</a>
    <div>
        <span class="u14Light_v2"><span class="emphasize" style="font-weight: 600;">{{ 269900 | money }}</span> <span style="text-decoration: line-through;">{{ product.price | money }}</span></span>
        <span class="u14Light_v2">or as low as €112/Month</span>
    </div>
</div>

<script>
    const search = getSearchValues()
    const variants = JSON.parse(JSON.stringify({{ product.variants | json }}))
    const size_map = {
        M: 'Fit for 170-185 cm',
        L: 'Fit for 180-195 cm'
    }

    let current_variant_id = null
    let current_variant = null
    const styles = {}
    const sizes = {}
    const models = {}

    const commonSwiper = [
        'https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-232407.png?v=1687274659',
        'https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-232428.png?v=1687274678',
        'https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-232506.png?v=1687274717',
        'https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-232525.png?v=1687274790',
        'https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-232545.png?v=1687274794',
        'https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-232556.png?v=1687274807'
    ]

    const medias = [
        {
            text: `“Best Electric Bike for 2022”`,
            img: "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/CNET-Logo_2x_585b6404-bc14-4a34-af64-299587c59efd.png?v=1687187217"
        },
        {
            text: `“Urtopia is an over the top e-bike”`,
            img: "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18604_2x_dbde7d31-6b13-4fa7-80be-7f7c1ea23c13.png?v=1687188893"
        },
        {
            text: `“Eye-catching styled carbon frame”`,
            img: "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18605_2x_1fb17080-bba1-42a3-a5e0-b5a5fe63c252.png?v=1687188923"
        },
        {
            text: `“The carbon pedelec from Urtopia is also stylish, light and electric.”`,
            img: "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18537_2x_ab067425-468d-4359-8136-daf2681d1af6.png?v=1687188959"
        },
        {
            text: `“Lightweight, networked and highly secure”`,
            img: "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18603_2x_a65ec9f7-1b63-459d-8b53-fb3624b5d492.png?v=1687188993"
        },
        {
            text: `“Lightweight carbon fiber road e-bike with affordably-price”`,
            img: "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/Mask_Group_18602_2x_d83cb682-76f4-43f5-809c-0212ebf68b24.png?v=1687188826"
        }
    ]

    const swiper_series = {
        Sirius: [
            "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-232107.png?v=1687274479",
            "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-232218.png?v=1687274560",
            "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-233138.png?v=1687275111"
        ],
        Lyra: [
            'https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-233229.png?v=1687275165'
        ],
        "Midnight in Paris": [
            "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-233218.png?v=1687275160"
        ],
        vanilla: [
            "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-232927.png?v=1687274978",
            "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-233005.png?v=1687275037",
            "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-233014.png?v=1687275040",
            "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-233020.png?v=1687275046",
            "https://cdn.shopify.com/s/files/1/0633/2068/6808/files/20230620-233024.png?v=1687275048"
        ]
    }
    
    const leftSwiper = new Swiper(".product .left-swiper", {
        direction: 'vertical',
        spaceBetween: 8,
        slidesPerView: 8,
        freeMode: true,
        watchSlidesProgress: true,
      })

      const rightSwiper = new Swiper(".product .right-swiper", {
        autoHeight: true,
        navigation: {
          nextEl: ".product .right-swiper .swiper-button-next",
          prevEl: ".product .right-swiper .swiper-button-prev",
        },
        pagination: {el:'.swiper-pagination'},
        effect: 'fade',
        fadeEffect:{
            crossFade: true
        },
        thumbs: {
          swiper: leftSwiper,
        },
      });

    function findVariantOptions (model, style, size) {
        return variants.find(v => `${model} / ${style} / ${size}` === v.title)
    }

    function findVariantFromId (id) {
        return variants.find(v => String(v.id) === String(id))
    }

    function findAvailableVariant () {
        return variants.find(v => v.available)
    }

    function changeVariant (model, size, style) {
        if (model) {
            $(`.product .product-panel .Model .active`).removeClass('active')
            $(`.product .product-panel .Model > div[attribute="${model}"]`).addClass('active')
            $(`.product .product-panel .options > div[option="Model"] .u17DemiBold_v2 .u17Light_v2`).text(`{{ product.title}} ${model === 'Carbon Belt' ? '1' : '1s'}`)

            $(`.product .commonComponent .sale .u20DemiBold_v2`).text(`${model === 'Carbon Belt' ? '{{ 269900 | money }}' : '{{ 299000 | money }}'} NOW`)
            $(`.product .commonComponent .sale .u17DemiBold_v2`).text(`with ${model === 'Carbon Belt' ? '{{ settings.sale_name }}' : 'Pre-order Sale'}`)

            $(`.product .count-down .u17Medium_v2`).text(`with ${model === 'Carbon Belt' ? '€600 off + 3 Free Accessories Ends in:' : '€300 off + 2 Free Accessories Ends in:'}`)
        }

        if (style) {
            $(`.product .product-panel .Style .active`).removeClass('active')
            $(`.product .product-panel .Style > div[attribute="${style}"]`).addClass('active')
            $(`.product .product-panel .options > div[option="Style"] .u17DemiBold_v2 .u17Light_v2`).text(style)

            let swiper_arr = []
            swiper_arr = swiper_arr.concat(swiper_series[style], style === 'vanilla' ? [] : commonSwiper)

            $('.product .right-swiper .swiper-wrapper').html(swiper_arr.map((s, i) => {
                const index = i % 6

                return  `<div class="swiper-slide">
                            <img src="${s}">
                            <div>
                                <span class="u20DemiBold_v2">${medias[index].text}</span>
                                <img src="${medias[index].img}">
                            </div>
                        </div>`
              }).join(''))
            $('.product .left-swiper .swiper-wrapper').html(swiper_arr.map(s => `<div class="swiper-slide"><img src="${s}"></div>`).join(''))
            
            // update
            setTimeout(() => {
                rightSwiper.update()
                rightSwiper.slideTo(0, 0)
                
                leftSwiper.update()
                leftSwiper.slideTo(0, 0)
            }, 0)
        }

        if (size) {
            $(`.product .product-panel .Size .active`).removeClass('active')
            $(`.product .product-panel .Size > div[attribute="${size}"]`).addClass('active')
            $(`.product .product-panel .options > div[option="Size"] .u17DemiBold_v2 .u17Light_v2`).text(size_map[size])
        }


        if (model && style && size) {
            current_variant = findVariantOptions(model, size, style)
            current_variant_id = current_variant.id


            history.replaceState(null, '', `${location.pathname}?variant=${current_variant_id}`);
            $('.product .product-panel input[name="id"]').val(current_variant_id)
            $('.product .delivery_time').text(global_config.ebike_delivery_time[current_variant_id])

            const btn =  $('.product .buttons .addToCartBtn')
            if (current_variant.available) {
                btn.find('span').text('Add to Cart')
                btn.removeClass('disabled')
                $('.product .buttons .orderTestRideBtn').show()
            } else {
                btn.find('span').text('Sold out')
                btn.addClass('disabled')
                $('.product .buttons .orderTestRideBtn').hide()
            }
        }

        console.log(current_variant)
    }


    function changeAddToCartText (parse, step = 0) {
        if (step) {
            $(".addToCartBtn i").toggleClass("showi");
            document.querySelector(".addToCartBtn span").innerHTML = "Adding...";
        } else {
            setTimeout(()=>{
                $(".addToCartBtn i").toggleClass("showi");
                document.querySelector(".addToCartBtn span").innerHTML = "Add to Cart";
            }, 800)
        }
    }

    function testRideTrace(type = '', target){

        // 如果已经有按钮 loading ,直接退出来
        if (!type || $('.orderTestRideBtn').hasClass('loading')) {
            return
        }
    
        const t = $(target)
    
        t.addClass('loading')
        // 原本的html 存起来
        const text = t.find('span').html()
        const loading = '<i class="fa fa-spinner fa-spin"></i>Processing...'
    
        // loading
        t.find('span').html(loading)
    
        
    
        if (type === 'lease_on_jobrad') {
            fetchBuried('websiteclick', `carbon-order-page`, { button: type }, true)
    
            t.removeClass('loading')
            t.find('span').html(text)
            return window.open(`/pages/ebike-leasing?bike_style=${current_variant.option1}&bike_size=${current_variant.option2}&utm_source=order_page#forms`)
        }
    
        if (type === 'klarna_check_out') {
            fetchBuried('websiteclick', `carbon-order-page`, { button: type, action_type: sessionStorage.carbon_one_a_b_test_flag }, true)
            window.sessionStorage.clicked_klarna_checkout_button = 'clicked_klarna_checkout_button'
    
            if (sessionStorage.carbon_one_a_b_test_flag === 'B') {
                setTimeout(() => {
                    t.removeClass('loading')
                    t.find('span').html(text)
                }, 2000)
                // 如果 B test 需要显示 klarna checkout
                window.show_notification_checkout_button = true
                return addToCartInsurance("atc", true)
            }
    
            const body = { items: [{ id: current_variant_id, quantity: 1 }] }
            body.items = body.items.concat(global_config.event_accessories_variant_ids.map(id => ({ id, quantity: 1 })))
    
    
            console.log('body', body)
    
    
            return fetch(window.Shopify.routes.root + 'cart/add.js', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            }).then(response => {
                location.href = `/checkout?show_klarna_dialog=show_klarna_dialog`
            }).catch((error) => {
                t.removeClass('loading')
                t.find('span').html(text)
            
                console.error('Error:', error);
            })
        }
    
        if (type === 'shop_on_mediamarkt') {
            t.removeClass('loading')
            t.find('span').html(text)
            return window.open('https://www.mediamarkt.de/de/search.html?query=urtopia&filter=carType%3ACitybike')
          
        }
    }

    {% for variant in product.variants %}
        models[{{ variant.option1 | json }}] = 1
        styles[{{ variant.option3 | json }}] = 1
        sizes[{{ variant.option2 | json }}] = 1
    {% endfor %}

    console.log('variants', variants)

    for (const model of Object.keys(models)) {
        $('.product .product-panel .Model').append(`<div attribute="${model}" class="${model}">${model}</div>`)
    }

    for (const style of Object.keys(styles)) {
        $('.product .product-panel .Style').append(`<div attribute="${style}" class="${style}"></div>`)
    }

    for (const size of Object.keys(sizes)) {
        $('.product .product-panel .Size').append(`<div attribute="${size}" class="${size} u17Light_v2">${size}</div>`)
    }


    $('.product-panel .options .option >div:not(.u17DemiBold_v2) > div').on('click',e => {
        const t = $(e.target)

        if ($(e.target).parent().hasClass('Model')) {
            changeVariant(t.attr('attribute'), current_variant.option2, current_variant.option3)
        } else if ($(e.target).parent().hasClass('Size')) {
            changeVariant(current_variant.option1, t.attr('attribute'), current_variant.option3)
        } else {
            changeVariant(current_variant.option1, current_variant.option2, t.attr('attribute'))
        }
    })

    // 如果有查询参数
    if (search.variant) {
        const find = findVariantFromId(search.variant)
        changeVariant(find.option1, find.option2, find.option3) 
    } else {
        const find = findAvailableVariant()
        changeVariant(find.option1, find.option2, find.option3) 
    }



    $('.accessories .navigate > div').on('click', e => {
        const items = $('.accessories .items')

        items.animate({
            scrollLeft: $('.accessories .items').scrollLeft() + ($(e.target).hasClass('next') ? 180 : -180)
        }, 300)
    })

    $('.accessories .items .item').on('click', e => {
        const item = $(e.target).closest('.item')
        const icon = item.find('.u11Light_v2')

        if (item.hasClass('active')) {
            item.removeClass('active')
            icon.html('<i class="fa-solid fa-plus"></i>')
            
        } else {
            item.addClass('active')
            icon.html('<i class="fa-solid fa-check"></i>')
        }
    })

    $('.product .product-panel').on("submit", function (event) {

        // 阻止默认行为
        event.preventDefault();
        return false;
    })

    $('.product .dialogs > div').on('click', e => {
        const m = {
            0: 'one',
            1: 'two',
            2: 'three',
            3: 'four'
        }

        $('.product .dialogs > div').each((i, t) => {
            if ($(e.target).closest('.u17Medium_v2')[0] === t) {
                console.log(i)

                const layer = document.querySelector(`.order-modal-${m[i]}`);
                const laybox = document.querySelector(`.order-modal-layer-${m[i]}`);
                layer.style.display = "flex";
                laybox.className += " dialog-open";
            }
        })
    })

    $('.toTop').on('click', e => {
        $('html').animate({
            scrollTop: 0
        }, 300)
    })


    let currnetScroolTop = 0
    $(document).on('scroll', throttle(e => {
        const top1 = $('#freedom').offset().top
        const top3 = $('.product .addToCartBtn').offset().top
        const top2 = $(e.target).scrollTop()

        const h = window.screen.height

        if (global_config.is_mobile) {
            if (top2 > top3) {
                $('.bottom-fixed').show()
            } else {
                $('.bottom-fixed').hide()
            }
        } else {
            if (top2 > top1) {
                $('.top-fixed').show()
            } else {
                $('.top-fixed').hide()
            }

            if (currnetScroolTop > top2) {
                $('.top-fixed').hide()
            }

            currnetScroolTop = top2
        }

        top2 > (h * 2) ? $('.toTop').show() : $('.toTop').hide()

    }, 300, 100))

    // 默认隐藏
    $('.bottom-fixed').hide()
    $('.top-fixed').hide()
    $('.toTop').hide()

    

    

    

    {% comment %} window.addEventListener('load', e => {
        $('.product .product-panel .buttons').prepend($('.js-insurance-product-template').html())
        $('.product .product-panel').prepend($('.js-insurance-metafields-template').html())
    }) {% endcomment %}
    
</script>